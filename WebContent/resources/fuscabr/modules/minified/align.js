/******************************************
 * FUScaBR - "Funções úteis para o ScadaBR"
 * Version 2.0 - License: MIT
 ******************************************/
"use strict";fuscabr.align={selectedItems:[],cannotDeleteWarning:function(){alert(fuscabr.common.i18n.align.cannot_delete_components)},createInterface:function(){if(!document.getElementById("fuscabr-align")){var e=document.createElement("div");e.id="fuscabr-align",e.className="borderDiv",ajaxGet("resources/fuscabr/templates/internal/alignDiv.html",function(t){e.innerHTML=t,document.getElementById("viewContent").parentElement.parentElement.appendChild(e),fuscabr.align.localizeInterface()})}},localizeInterface:function(){var e=document.querySelectorAll("#fuscabr-align *[data-i18n]");for(var t of e){var n=t.getAttribute("data-i18n");fuscabr.common.i18n.align[n]&&localizeElement(t,fuscabr.common.i18n.align[n])}},createListeners:function(){var e=document.querySelectorAll("#viewContent > div:not(.fuscabr-align):not(.windowDiv)");for(var t of e)t.addEventListener("mouseover",fuscabr.align.drawHoverBorder),t.addEventListener("mouseout",fuscabr.align.clearBorder),t.addEventListener("click",fuscabr.align.selectItem),t.classList.add("fuscabr-align")},removeListeners:function(){var e=document.querySelectorAll("#viewContent > div.fuscabr-align");for(var t of e)t.removeEventListener("mouseover",fuscabr.align.drawHoverBorder),t.removeEventListener("mouseout",fuscabr.align.clearBorder),t.removeEventListener("click",fuscabr.align.selectItem),t.style.margin="",t.style.border="",t.classList.remove("fuscabr-align");fuscabr.align.selectedItems.length&&(this.selectedItems[0].removeEventListener("mouseup",fuscabr.align.getAnchorPosition),document.getElementById("fuscabr-anchor").remove())},updateListeners:function(){setTimeout(fuscabr.align.createListeners,200)},alignKeyboardShortcuts:function(){"KeyA"==event.code?fuscabr.align.alignLeft():"KeyD"==event.code?fuscabr.align.alignRight():"KeyW"==event.code?fuscabr.align.alignTop():"KeyX"==event.code?fuscabr.align.alignBottom():"KeyF"==event.code?fuscabr.align.centerHorizontal():"KeyG"==event.code?fuscabr.align.centerVertical():"KeyR"==event.code?fuscabr.align.distributeHorizontal():"KeyT"==event.code?fuscabr.align.distributeVertical():"Escape"==event.code?fuscabr.align.stop():"KeyS"==event.code&&fuscabr.align.restart()},moveKeyboardShortcuts:function(e){var t=fuscabr.align.conf.moveAnchorOffset;"ArrowUp"==event.code?(e.preventDefault(),fuscabr.align.relativeMoveAnchor(0,-t)):"ArrowDown"==event.code?(fuscabr.align.relativeMoveAnchor(0,+t),event.preventDefault()):"ArrowLeft"==event.code?(fuscabr.align.relativeMoveAnchor(-t,0),event.preventDefault()):"ArrowRight"==event.code&&(fuscabr.align.relativeMoveAnchor(+t,0),event.preventDefault())},enableKeyboardMoving:function(e){e?window.addEventListener("keydown",fuscabr.align.moveKeyboardShortcuts):window.removeEventListener("keydown",fuscabr.align.moveKeyboardShortcuts)},drawHoverBorder:function(){var e=fuscabr.align.conf;this.style.margin="-2px",this.style.border="2px solid "+e.hoverBorderColor},clearBorder:function(){this.style.margin="",this.style.border=""},selectItem:function(){this.removeEventListener("mouseover",fuscabr.align.drawHoverBorder),this.removeEventListener("mouseout",fuscabr.align.clearBorder),this.removeEventListener("click",fuscabr.align.selectItem),fuscabr.align.selectedItems.push(this);var e=fuscabr.align.conf;if(1==fuscabr.align.selectedItems.length){var t=document.createElement("span");t.id="fuscabr-anchor",t.innerHTML=fuscabr.common.i18n.align.anchor||"Anchor",t.style="text-transform: uppercase; font-size: 9px; z-index: 20; \t\t\t               position: absolute; top: -15px; color: "+e.anchorBorderColor,this.appendChild(t),this.style.margin="-2px",this.style.border="2px solid "+e.anchorBorderColor,this.addEventListener("mouseup",fuscabr.align.getAnchorPosition),fuscabr.align.getAnchorPosition()}else this.style.margin="-2px",this.style.border="2px solid "+e.elementBorderColor},getAnchorPosition:function(){var e=fuscabr.align.selectedItems[0].style.left.replace("px",""),t=fuscabr.align.selectedItems[0].style.top.replace("px","");return document.getElementById("fuscabr-align-x-anchor").value=e,document.getElementById("fuscabr-align-y-anchor").value=t,[e,t]},absoluteMoveAnchor:function(){var e=document.getElementById("fuscabr-align-x-anchor").value,t=document.getElementById("fuscabr-align-y-anchor").value;fuscabr.align.selectedItems[0].style.left=Math.round(e)+"px",fuscabr.align.selectedItems[0].style.top=Math.round(t)+"px",updateViewComponentLocation(fuscabr.align.selectedItems[0].id)},relativeMoveAnchor:function(e,t){var n=fuscabr.align.getAnchorPosition();if(e){var r=n[0];r=n[0]-n[0]%e+e,fuscabr.align.selectedItems[0].style.left=Math.round(r)+"px"}if(t){var a=n[1];a=n[1]-n[1]%t+t,fuscabr.align.selectedItems[0].style.top=Math.round(a)+"px"}fuscabr.align.getAnchorPosition(),updateViewComponentLocation(fuscabr.align.selectedItems[0].id)},alignLeft:function(){var e=this.selectedItems[0].style.left;for(var t of this.selectedItems)t.style.left=e,updateViewComponentLocation(t.id)},alignTop:function(){var e=this.selectedItems[0].style.top;for(var t of this.selectedItems)t.style.top=e,updateViewComponentLocation(t.id)},alignRight:function(){var e=Number(this.selectedItems[0].style.left.replace("px",""))+Number(this.selectedItems[0].clientWidth);for(var t of this.selectedItems){var n=Number(t.style.left.replace("px","")),r=n+(e-(n+Number(t.clientWidth)));t.style.left=Math.round(r)+"px",updateViewComponentLocation(t.id)}},alignBottom:function(){var e=Number(this.selectedItems[0].style.top.replace("px",""))+Number(this.selectedItems[0].clientHeight);for(var t of this.selectedItems){var n=Number(t.style.top.replace("px","")),r=n+(e-(n+Number(t.clientHeight)));t.style.top=Math.round(r)+"px",updateViewComponentLocation(t.id)}},centerHorizontal:function(){var e=Number(this.selectedItems[0].style.left.replace("px",""))+Number(this.selectedItems[0].clientWidth)/2;for(var t of this.selectedItems){var n=Number(t.style.left.replace("px","")),r=n+(e-(n+Number(t.clientWidth)/2));t.style.left=Math.round(r)+"px",updateViewComponentLocation(t.id)}},centerVertical:function(){var e=Number(this.selectedItems[0].style.top.replace("px",""))+Number(this.selectedItems[0].clientHeight)/2;for(var t of this.selectedItems){var n=Number(t.style.top.replace("px","")),r=n+(e-(n+Number(t.clientHeight)/2));t.style.top=Math.round(r)+"px",updateViewComponentLocation(t.id)}},distributeHorizontal:function(){if(!(this.selectedItems.length<3)){var e=this.selectedItems.slice();e.sort(function(e,t){return Number(e.style.left.replace("px",""))>Number(t.style.left.replace("px",""))?1:-1});for(var t=e.length-1,n=Number(e[0].style.left.replace("px","")),r=Number(e[t].style.left.replace("px",""))-n,a=0;a<t;a++)r-=e[a].clientWidth;r/=t;for(a=1;a<t;a++){var o=Number(e[a-1].style.left.replace("px",""))+Number(e[a-1].clientWidth)+r;e[a].style.left=Math.round(o)+"px",updateViewComponentLocation(e[a].id),this.getAnchorPosition()}}},distributeVertical:function(){if(!(this.selectedItems.length<3)){var e=this.selectedItems.slice();e.sort(function(e,t){return Number(e.style.top.replace("px",""))>Number(t.style.top.replace("px",""))?1:-1});for(var t=e.length-1,n=Number(e[0].style.top.replace("px","")),r=Number(e[t].style.top.replace("px",""))-n,a=0;a<t;a++)r-=e[a].clientHeight;r/=t;for(a=1;a<t;a++){var o=Number(e[a-1].style.top.replace("px",""))+Number(e[a-1].clientHeight)+r;e[a].style.top=Math.round(o)+"px",updateViewComponentLocation(e[a].id),this.getAnchorPosition()}}},start:function(){document.querySelector("img[onclick='addViewComponent()']").addEventListener("click",fuscabr.align.updateListeners),document.body.addEventListener("keyup",fuscabr.align.alignKeyboardShortcuts),this.createListeners(),this.selectedItems=[],this.deleteComponentBackup=deleteViewComponent,deleteViewComponent=this.cannotDeleteWarning,document.getElementById("fuscabr-align-start-stop").value=fuscabr.common.i18n.align.stop_alignment,document.getElementById("fuscabr-align-start-stop").setAttribute("onclick","fuscabr.align.stop()"),document.getElementById("fuscabr-align-controls").style.display=""},stop:function(){document.querySelector("img[onclick='addViewComponent()']").removeEventListener("click",fuscabr.align.updateListeners),document.body.removeEventListener("keyup",fuscabr.align.alignKeyboardShortcuts),this.removeListeners(),this.enableKeyboardMoving(!1),document.getElementById("fuscabr-keyboard-moving").checked=!1,this.selectedItems=[],deleteViewComponent=this.deleteComponentBackup,document.getElementById("fuscabr-align-start-stop").value=fuscabr.common.i18n.align.start_alignment,document.getElementById("fuscabr-align-start-stop").setAttribute("onclick","fuscabr.align.start()"),document.getElementById("fuscabr-align-controls").style.display="none"},restart:function(){this.removeListeners(),this.createListeners(),this.selectedItems=[],document.getElementById("fuscabr-align-x-anchor").value="",document.getElementById("fuscabr-align-y-anchor").value=""},getSettings:function(){ajaxGetJson("resources/fuscabr/conf/modules/align.json",function(e){fuscabr.align.conf=e,fuscabr.align.init()})},init:function(){fuscabr.align.conf?fuscabr.align.createInterface():fuscabr.align.getSettings()}},fuscabr.align.init();
